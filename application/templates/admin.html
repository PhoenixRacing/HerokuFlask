{% extends 'base.html' %}

{% block styles %}
{{super()}}
<link rel="stylesheet" type="text/css" href="{{url_for('static',filename='css/admin.css')}}">
{% endblock %}

{% block content %}
<div class="banner row">
	<div class="small-12">
		<div class="row">
			<div class="small-offset-2 small-8 columns">
				<h1>User List</h1>
			</div>
		</div>
		<div class="row">
			<div class="small-offset-2 small-8 columns">
				<script type="text/javascript">
				modify_user_access = function(access_select){
					console.log(access_select)
					console.log(access_select.selector)
					id = access_select.selector.split("_")[1]
					prefix = "{{url_for('modify_access',user_id='1')}}".split("1")[0]
					url = prefix + id + '/'
					console.log(url,{access:'edit'})
					// $.post(url)
					$.ajax({
						type: "POST",
						contentType: "application/json; charset=utf-8",
						url: url,
						data: '{ "access": "'+access_select.val()+'"}',
						success: function (data) {
							// TODO, make some sort of indication to the user that the save was successful
						},
						dataType: "json"
					});
					// location.reload()
				}

				delete_user = function(user_id){

				}
				</script>
				<table>
					<thead>
						<tr>
							<th>Name</th>
							<th>Email</th>
							<th>Access</th>
							<th>Save</th>
							<th>Remove</th>
						</tr>
					</thead>
					{% for user in users %}
					<tbody>
						<tr>
							<td>{{user.first_name}} {{user.last_name}}</td>
							<td>{{user.email}}</td>
							<td>
								<select id="access_{{user.id}}">
									{% for val in user.access_levels%}
									<option value="{{val}}" {% if val==user.access%}selected="selected"{%endif%}>{{val}}</option>
									{%endfor%}
								</select>
							</td>
							<td class="text-center"><button onclick="modify_user_access($('#access_{{user.id}}'))"><i class="fi-check"></i></button></td>
							<td class="text-center"><button onclick="$.post('{{url_for('delete_user',user_id=user.id)}}');location.reload()"><i class="fi-x"></i></button></td>
						</tr>
					</tbody>
					{% endfor %}
				</table>
			</div>
		</div>
	</div>
</div>
{% endblock %}